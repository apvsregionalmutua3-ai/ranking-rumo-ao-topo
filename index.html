<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ranking de Vendas #RAT 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #111827; /* bg-gray-900 */
        }
        .text-glow {
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
        }
        .card {
            background-color: #1F2937; /* bg-gray-800 */
            border: 1px solid #374151; /* border-gray-700 */
            transition: all 0.3s ease;
        }
        .progress-bar-wrapper {
            padding: 4px;
            background: #111827;
            border-radius: 9999px;
            position: relative;
        }
        .progress-bar-container {
            background-color: #374151; /* bg-gray-700 */
            position: relative;
        }
        .progress-bar {
            transition: width 0.5s ease-out, background 0.5s ease;
        }
        .rocket {
            position: absolute;
            top: 50%;
            transform: translateY(-50%) translateX(50%);
            font-size: 24px;
            transition: left 0.5s ease-out;
            animation: bounce 1s infinite alternate;
        }
        @keyframes bounce {
            from { transform: translateY(-55%) translateX(50%) rotate(0deg); }
            to { transform: translateY(-45%) translateX(50%) rotate(0deg); }
        }
        .table-header {
            background-color: #374151; /* bg-gray-700 */
        }
        .table-row-odd {
            background-color: #1F2937; /* bg-gray-800 */
        }
        .table-row-even {
            background-color: #1a2330;
        }
        .table-row:hover {
            background-color: #374151; /* bg-gray-700 */
        }
        .podium-item {
            transition: all 0.3s ease-in-out;
        }
        .podium-1 {
            transform: scale(1.1) translateY(-10px);
            border: 2px solid #FBBF24; /* amber-400 */
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
        }
        .regional-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 9999px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 8px;
            text-transform: uppercase;
        }
        .details-row {
            display: none;
        }
        .details-row.visible {
            display: table-row;
        }
        .cursor-pointer {
             cursor: pointer;
        }
    </style>
</head>
<body class="text-gray-200 p-4 sm:p-6 md:p-8">

    <div class="max-w-7xl mx-auto">

        <!-- Cabe√ßalho Principal -->
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-extrabold text-white text-glow mb-2">SETEMBRO #RAT 2025</h1>
            <p id="last-updated" class="text-sm text-gray-400">A carregar dados...</p>
        </header>

        <!-- Card de Meta Total -->
        <div class="card rounded-xl p-6 mb-8 shadow-lg">
            <div class="flex flex-wrap justify-between items-center gap-4">
                <div class="flex-grow">
                    <h2 class="text-xl font-semibold text-white">Progresso Total</h2>
                    <p class="text-gray-400">üéØ META DE | <span id="meta-total" class="font-bold">--</span></p>
                </div>
                <div class="text-right">
                    <p id="total-vendas" class="text-3xl font-bold text-white">--</p>
                    <p id="faltam-vendas" class="text-red-400 font-semibold">FALTAM: --</p>
                </div>
            </div>
             <div class="progress-bar-wrapper mt-4">
                <div class="progress-bar-container w-full rounded-full h-4 overflow-visible">
                    <div id="total-progress" class="progress-bar h-4 rounded-full" style="width: 0%;"></div>
                    <div id="rocket" class="rocket" style="left: 0%;">üöÄ</div>
                </div>
            </div>
        </div>

        <!-- Destaque TOP 3 Consultores -->
        <div class="mb-10 text-center">
            <h2 class="text-2xl font-bold text-white mb-6">üèÜ TOP 3 CONSULTORES üèÜ</h2>
            <div id="podium-container" class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-0 items-end justify-center">
                <!-- P√≥dio gerado via JS -->
            </div>
        </div>


        <!-- Container dos Rankings -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- Coluna 1: Regionais Equipe -->
            <div class="card rounded-xl p-4 sm:p-6 shadow-lg lg:col-span-1">
                <h3 class="text-xl font-bold text-center mb-4 text-white">REGIONAIS</h3>
                <p class="text-sm text-center text-gray-400 mb-4 font-mono">Produ√ß√£o EQUIPE</p>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs text-gray-300 uppercase table-header">
                            <tr>
                                <th scope="col" class="px-4 py-3 rounded-l-lg">Pos.</th>
                                <th scope="col" class="px-4 py-3">Nome</th>
                                <th scope="col" class="px-4 py-3 rounded-r-lg text-center">Vendas/Meta</th>
                            </tr>
                        </thead>
                        <tbody id="regionais-equipe">
                            <!-- Linhas geradas via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Coluna 2: Regionais Individual -->
            <div class="card rounded-xl p-4 sm:p-6 shadow-lg lg:col-span-1">
                <h3 class="text-xl font-bold text-center mb-4 text-white">REGIONAIS</h3>
                <p class="text-sm text-center text-gray-400 mb-4 font-mono">Produ√ß√£o INDIVIDUAL</p>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs text-gray-300 uppercase table-header">
                            <tr>
                                <th scope="col" class="px-4 py-3 rounded-l-lg">Pos.</th>
                                <th scope="col" class="px-4 py-3">Nome</th>
                                <th scope="col" class="px-4 py-3 rounded-r-lg text-center">Vendas</th>
                            </tr>
                        </thead>
                        <tbody id="regionais-individual">
                            <!-- Linhas geradas via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Coluna 3: Consultores Individual -->
            <div class="card rounded-xl p-4 sm:p-6 shadow-lg lg:col-span-1">
                <h3 class="text-xl font-bold text-center mb-4 text-white">CONSULTORES</h3>
                <p class="text-sm text-center text-gray-400 mb-4 font-mono">Produ√ß√£o INDIVIDUAL</p>
                 <div class="overflow-y-auto max-h-[600px] pr-2">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs text-gray-300 uppercase table-header sticky top-0">
                            <tr>
                                <th scope="col" class="px-4 py-3 rounded-l-lg">Pos.</th>
                                <th scope="col" class="px-4 py-3">Nome</th>
                                <th scope="col" class="px-4 py-3 rounded-r-lg text-center">Vendas</th>
                            </tr>
                        </thead>
                        <tbody id="consultores-individual">
                            <!-- Linhas geradas via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>

    <script>
        // URLs publicadas da sua Planilha Google
        const sheetUrls = {
            regionaisEquipe: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRHWgxdgqdfV-nqEnuakTqxmRd38LCa6skppzvM3yTjZ8ynHD1mDsYcQcRjHjJDFnDOD29ThEsZEmZS/pub?gid=0&single=true&output=csv',
            regionaisIndividual: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRHWgxdgqdfV-nqEnuakTqxmRd38LCa6skppzvM3yTjZ8ynHD1mDsYcQcRjHjJDFnDOD29ThEsZEmZS/pub?gid=452755695&single=true&output=csv',
            consultores: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRHWgxdgqdfV-nqEnuakTqxmRd38LCa6skppzvM3yTjZ8ynHD1mDsYcQcRjHjJDFnDOD29ThEsZEmZS/pub?gid=1115588777&single=true&output=csv'
        };

        // Paleta de cores para as regionais
        const regionalColors = {
            'Rangel': 'bg-red-500', 'Barcellos': 'bg-blue-500', 'Brunelli': 'bg-green-500',
            'Menezes': 'bg-yellow-500', 'Queiruja': 'bg-indigo-500', 'Reis': 'bg-purple-500',
            'Nunes': 'bg-pink-500', 'Figueiredo': 'bg-teal-500', 'Borges': 'bg-orange-500',
            'Oliveira': 'bg-cyan-500', 'Abrantes': 'bg-lime-500', 'Silva': 'bg-emerald-500',
            'Dias': 'bg-amber-500'
        };

        // Fun√ß√£o para buscar e processar dados de um CSV
        async function fetchAndParseCSV(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const text = await response.text();
                const rows = text.split('\n').map(row => row.trim().split(','));
                const headers = rows.shift();
                return rows.map(row => {
                    let obj = {};
                    headers.forEach((header, i) => {
                        obj[header.trim()] = row[i] ? row[i].trim() : '';
                    });
                    return obj;
                });
            } catch (error) {
                console.error(`Erro ao buscar dados de ${url}:`, error);
                return []; // Retorna array vazio em caso de erro
            }
        }

        function getMedal(position) {
            position = parseInt(position);
            if (position === 1) return 'ü•á';
            if (position === 2) return 'ü•à';
            if (position === 3) return 'ü•â';
            return position;
        }

        function toggleDetails(regionalNome) {
            const detailsRow = document.getElementById(`details-${regionalNome}`);
            if (detailsRow) {
                detailsRow.classList.toggle('visible');
            }
        }
        
        function populatePodium(data) {
            const podiumContainer = document.getElementById('podium-container');
            if (!podiumContainer || data.length < 3) return;

            const top3 = data.slice(0, 3);
            const podiumOrder = [top3[1], top3[0], top3[2]]; // 2¬∫, 1¬∫, 3¬∫

            podiumContainer.innerHTML = podiumOrder.map((consultor, index) => {
                const isFirstPlace = consultor.Pos === '1';
                const podiumClass = isFirstPlace ? 'podium-1' : '';
                const orderClass = index === 0 ? 'md:order-1' : (index === 1 ? 'md:order-2' : 'md:order-3');
                
                const initials = consultor.Nome.split(' ').map(n => n[0]).join('');

                return `
                    <div class="card rounded-xl p-4 shadow-lg podium-item ${podiumClass} ${orderClass}">
                         <div class="relative">
                            <div class="w-24 h-24 mx-auto rounded-full bg-gray-700 flex items-center justify-center mb-3 border-4 ${isFirstPlace ? 'border-amber-400' : 'border-gray-600'}">
                               <span class="text-3xl font-bold">${initials}</span>
                            </div>
                            ${isFirstPlace ? '<span class="absolute top-0 right-1/2 translate-x-[80px] text-3xl">üëë</span>' : ''}
                        </div>
                        <h4 class="text-lg font-bold text-white text-glow">${consultor.Nome}</h4>
                        <p class="text-3xl font-extrabold text-cyan-400">${consultor.Vendas}</p>
                        <p class="text-sm text-gray-400">vendas</p>
                    </div>
                `;
            }).join('');
        }


        async function populateAllTables() {
            try {
                // Busca todos os dados em paralelo
                const [dataRegionaisEquipe, dataRegionaisIndividual, dataConsultores] = await Promise.all([
                    fetchAndParseCSV(sheetUrls.regionaisEquipe),
                    fetchAndParseCSV(sheetUrls.regionaisIndividual),
                    fetchAndParseCSV(sheetUrls.consultores)
                ]);

                // Popula tabelas
                populateRegionaisEquipe(dataRegionaisEquipe, dataConsultores);
                populateSimpleTable('regionais-individual', dataRegionaisIndividual, ['Pos', 'Nome', 'Vendas']);
                populateConsultoresTable(dataConsultores);
                
                // Popula p√≥dio
                populatePodium(dataConsultores);

                // Atualiza cabe√ßalho e progresso
                updateHeaderAndProgress(dataRegionaisEquipe);
                updateTimestamp();

            } catch (error) {
                console.error("Erro ao popular as tabelas:", error);
                document.getElementById('last-updated').textContent = "Erro ao carregar dados.";
            }
        }

        function populateRegionaisEquipe(dataEquipe, dataConsultores) {
            const tableBody = document.getElementById('regionais-equipe');
            if (!tableBody) return;
            tableBody.innerHTML = '';

            dataEquipe.forEach((item, index) => {
                const row = document.createElement('tr');
                const rowClass = index % 2 === 0 ? 'table-row-even' : 'table-row-odd';
                row.className = `table-row ${rowClass} border-b border-gray-700 cursor-pointer`;
                row.onclick = () => toggleDetails(item.Nome);

                const vendas = parseInt(item.Vendas);
                const meta = parseInt(item.Meta);
                const percentage = meta > 0 ? Math.min((vendas / meta) * 100, 100) : 0;
                
                const statusIcon = percentage >= 50 ? '‚ö°Ô∏è' : '‚è≥';

                row.innerHTML = `
                    <td class="px-4 py-3 font-medium">${getMedal(item.Pos)}</td>
                    <td class="px-4 py-3 font-semibold">${item.Nome}</td>
                    <td class="px-4 py-3">
                        <div class="flex items-center justify-end gap-2">
                            <span class="font-mono">${vendas}/${meta}</span>
                            <span class="w-4 h-4 text-center">${statusIcon}</span>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
                
                // Linha de detalhes (inicialmente escondida)
                const detailsRow = document.createElement('tr');
                detailsRow.id = `details-${item.Nome}`;
                detailsRow.className = 'details-row';
                
                const consultoresDaRegional = dataConsultores.filter(c => c.Regional === item.Nome);
                
                let detailsContent = '<td colspan="3" class="p-3 bg-gray-900">';
                if(consultoresDaRegional.length > 0) {
                    detailsContent += `
                        <table class="w-full text-xs bg-gray-900">
                            <thead class="text-gray-400"><tr><th class="p-2">Pos.</th><th class="p-2">Consultor</th><th class="p-2 text-center">Vendas</th></tr></thead>
                            <tbody>
                                ${consultoresDaRegional.map(c => `<tr><td class="p-2">${c.Pos}¬∫</td><td class="p-2">${c.Nome}</td><td class="p-2 text-center">${c.Vendas}</td></tr>`).join('')}
                            </tbody>
                        </table>
                    `;
                } else {
                    detailsContent += '<p class="text-center text-gray-500 text-xs py-2">Nenhum consultor associado a esta regional.</p>';
                }
                detailsContent += '</td>';
                detailsRow.innerHTML = detailsContent;
                tableBody.appendChild(detailsRow);
            });
        }
        
         function populateConsultoresTable(data) {
            const tableBody = document.getElementById('consultores-individual');
            if (!tableBody) return;
            tableBody.innerHTML = '';

            data.forEach((item, index) => {
                const row = document.createElement('tr');
                const rowClass = index % 2 === 0 ? 'table-row-even' : 'table-row-odd';
                row.className = `table-row ${rowClass} border-b border-gray-700`;

                const regionalTag = item.Regional ? 
                    `<span class="regional-tag ${regionalColors[item.Regional] || 'bg-gray-500'}">${item.Regional}</span>` : '';

                row.innerHTML = `
                    <td class="px-4 py-3 font-medium">${getMedal(item.Pos)}</td>
                    <td class="px-4 py-3 font-semibold flex items-center">${item.Nome} ${regionalTag}</td>
                    <td class="px-4 py-3 text-center font-bold">${item.Vendas}</td>
                `;
                tableBody.appendChild(row);
            });
        }


        function populateSimpleTable(tableId, data, headers) {
            const tableBody = document.getElementById(tableId);
            if (!tableBody) return;
            tableBody.innerHTML = '';

            data.forEach((item, index) => {
                const row = document.createElement('tr');
                const rowClass = index % 2 === 0 ? 'table-row-even' : 'table-row-odd';
                row.className = `table-row ${rowClass} border-b border-gray-700`;

                row.innerHTML = `
                    <td class="px-4 py-3 font-medium">${getMedal(item[headers[0]])}</td>
                    <td class="px-4 py-3 font-semibold">${item[headers[1]]}</td>
                    <td class="px-4 py-3 text-center font-bold">${item[headers[2]]}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function updateHeaderAndProgress(dataEquipe) {
            const totalVendas = dataEquipe.reduce((sum, item) => sum + parseInt(item.Vendas || 0), 0);
            const metaTotal = dataEquipe.reduce((sum, item) => sum + parseInt(item.Meta || 0), 0);
            const faltam = metaTotal - totalVendas;
            const percentage = metaTotal > 0 ? (totalVendas / metaTotal) * 100 : 0;

            document.getElementById('total-vendas').textContent = totalVendas;
            document.getElementById('meta-total').textContent = metaTotal;
            document.getElementById('faltam-vendas').textContent = `FALTAM: ${faltam > 0 ? faltam : 0}`;
            
            const progressBar = document.getElementById('total-progress');
            const rocket = document.getElementById('rocket');
            
            progressBar.style.width = `${percentage}%`;
            rocket.style.left = `${percentage}%`;

            if (percentage >= 80) {
                 progressBar.style.background = 'linear-gradient(90deg, #FBBF24, #F59E0B)'; // Dourado
            } else if (percentage >= 50) {
                 progressBar.style.background = 'linear-gradient(90deg, #F97316, #FBBF24)'; // Laranja para Amarelo
            } else {
                 progressBar.style.background = 'linear-gradient(90deg, #F97316, #EF4444)'; // Laranja para Vermelho
            }
        }


        function updateTimestamp() {
            const now = new Date();
            const date = now.toLocaleDateString('pt-BR');
            const time = now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('last-updated').textContent = `Atualizado em: ${date} ${time}`;
        }

        // Popula as tabelas quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', () => {
            populateAllTables();
        });
    </script>
</body>
</html>

