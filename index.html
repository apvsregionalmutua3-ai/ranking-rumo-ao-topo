<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ranking de Vendas #RAT 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #111827; /* bg-gray-900 */
        }
        .text-glow {
            text-shadow: 0 0 8px rgba(59, 130, 246, 0.6);
        }
        .card {
            background-color: #1F2937; /* bg-gray-800 */
            border: 1px solid #374151; /* border-gray-700 */
            transition: all 0.3s ease;
        }
        .progress-bar-wrapper {
            position: relative;
            height: 24px;
        }
        .progress-bar-container {
            background-color: #374151; /* bg-gray-700 */
            height: 16px;
            position: absolute;
            width: 100%;
            top: 4px;
        }
        .progress-bar {
            transition: width 1s ease-out, background 1s ease;
        }
        .rocket-icon {
            position: absolute;
            top: 0;
            font-size: 24px;
            transition: left 1s ease-out;
            transform: translateX(-50%);
            animation: bounce 1s infinite alternate;
        }
        @keyframes bounce {
            from { transform: translateX(-50%) translateY(0px); }
            to { transform: translateX(-50%) translateY(-3px); }
        }
        .table-header {
            background-color: #374151; /* bg-gray-700 */
        }
        .table-row-odd {
            background-color: #1F2937; /* bg-gray-800 */
        }
        .table-row-even {
            background-color: #1a2330;
        }
        .table-row:hover {
            background-color: #374151; /* bg-gray-700 */
        }
        .details-row {
            display: none;
        }
        .details-row.open {
            display: table-row;
        }
        /* Estilos do p√≥dio */
        .podium-container {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 1rem;
        }
        .podium-card {
            width: 32%;
            text-align: center;
            padding: 1rem;
            border-radius: 0.75rem;
            transition: transform 0.3s ease;
        }
        .podium-1 {
            order: 2;
            transform: translateY(-15px);
            border: 2px solid #FBBF24; /* amber-400 */
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.5);
        }
        .podium-2 { order: 1; }
        .podium-3 { order: 3; }
        .podium-trophy {
            font-size: 2.5rem; /* 40px */
            line-height: 1;
        }
        .podium-1 .podium-trophy {
            font-size: 3.5rem; /* 56px */
        }
        .regional-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 8px;
            vertical-align: middle;
            color: #fff;
        }
    </style>
</head>
<body class="text-gray-200 p-4 sm:p-6 md:p-8">

    <div class="max-w-7xl mx-auto">

        <!-- Cabe√ßalho Principal -->
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-white text-glow mb-2">SETEMBRO #RAT 2025</h1>
            <p id="last-updated" class="text-sm text-gray-400">Atualizado em: --/--/---- --:--</p>
        </header>

        <!-- Card de Meta Total -->
        <div class="card rounded-xl p-6 mb-8 shadow-lg">
            <div class="flex flex-wrap justify-between items-center gap-4">
                <div class="flex-grow">
                    <h2 class="text-xl font-semibold text-white">Progresso Total</h2>
                    <p class="text-gray-400">üéØ META DE | <span id="meta-total" class="font-bold">1103</span></p>
                </div>
                <div class="text-right">
                    <p id="total-vendas" class="text-3xl font-bold text-white">0</p>
                    <p id="faltam-vendas" class="text-red-400 font-semibold">FALTAM: 1103</p>
                </div>
            </div>
            <div class="progress-bar-wrapper w-full mt-4">
                <div class="progress-bar-container w-full rounded-full overflow-hidden">
                    <div id="total-progress" class="progress-bar h-full rounded-full" style="width: 0%;"></div>
                </div>
                <span id="rocket" class="rocket-icon" style="left: 0%;">üöÄ</span>
            </div>
        </div>
        
        <!-- Destaque TOP 3 Consultores -->
        <div class="card rounded-xl p-4 sm:p-6 mb-8 shadow-lg">
            <h2 class="text-xl font-bold text-center mb-4 text-white">üèÜ TOP 3 CONSULTORES üèÜ</h2>
            <div id="top3-podium" class="podium-container">
                <!-- P√≥dio gerado via JS -->
            </div>
        </div>

        <!-- Container dos Rankings -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- Coluna 1: Regionais Equipe -->
            <div class="card rounded-xl p-4 sm:p-6 shadow-lg lg:col-span-1">
                <h3 class="text-xl font-bold text-center mb-4 text-white">REGIONAIS</h3>
                <p class="text-sm text-center text-gray-400 mb-4 font-mono">Produ√ß√£o EQUIPE</p>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs text-gray-300 uppercase table-header">
                            <tr>
                                <th scope="col" class="px-4 py-3 rounded-l-lg">Pos.</th>
                                <th scope="col" class="px-4 py-3">Nome</th>
                                <th scope="col" class="px-4 py-3 rounded-r-lg text-center">Vendas/Meta</th>
                            </tr>
                        </thead>
                        <tbody id="regionais-equipe">
                            <!-- Linhas geradas via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Coluna 2: Regionais Individual -->
            <div class="card rounded-xl p-4 sm:p-6 shadow-lg lg:col-span-1">
                <h3 class="text-xl font-bold text-center mb-4 text-white">REGIONAIS</h3>
                <p class="text-sm text-center text-gray-400 mb-4 font-mono">Produ√ß√£o INDIVIDUAL</p>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs text-gray-300 uppercase table-header">
                            <tr>
                                <th scope="col" class="px-4 py-3 rounded-l-lg">Pos.</th>
                                <th scope="col" class="px-4 py-3">Nome</th>
                                <th scope="col" class="px-4 py-3 rounded-r-lg text-center">Vendas</th>
                            </tr>
                        </thead>
                        <tbody id="regionais-individual">
                            <!-- Linhas geradas via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Coluna 3: Consultores Individual -->
            <div class="card rounded-xl p-4 sm:p-6 shadow-lg lg:col-span-1">
                <h3 class="text-xl font-bold text-center mb-4 text-white">CONSULTORES</h3>
                <p class="text-sm text-center text-gray-400 mb-4 font-mono">Produ√ß√£o INDIVIDUAL</p>
                 <div class="overflow-y-auto max-h-[600px] pr-2">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs text-gray-300 uppercase table-header sticky top-0">
                            <tr>
                                <th scope="col" class="px-4 py-3 rounded-l-lg">Pos.</th>
                                <th scope="col" class="px-4 py-3">Nome</th>
                                <th scope="col" class="px-4 py-3 rounded-r-lg text-center">Vendas</th>
                            </tr>
                        </thead>
                        <tbody id="consultores-individual">
                            <!-- Linhas geradas via JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // URLs publicadas da sua Planilha Google
        const sheetUrls = {
            regionaisEquipe: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRHWgxdgqdfV-nqEnuakTqxmRd38LCa6skppzvM3yTjZ8ynHD1mDsYcQcRjHjJDFnDOD29ThEsZEmZS/pub?gid=0&single=true&output=csv',
            regionaisIndividual: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRHWgxdgqdfV-nqEnuakTqxmRd38LCa6skppzvM3yTjZ8ynHD1mDsYcQcRjHjJDFnDOD29ThEsZEmZS/pub?gid=452755695&single=true&output=csv',
            consultores: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRHWgxdgqdfV-nqEnuakTqxmRd38LCa6skppzvM3yTjZ8ynHD1mDsYcQcRjHjJDFnDOD29ThEsZEmZS/pub?gid=1115588777&single=true&output=csv'
        };
        
        // Cores para as etiquetas das regionais
        const regionalColors = {
            'Rangel': 'bg-red-500', 'Barcellos': 'bg-blue-500', 'Brunelli': 'bg-green-500',
            'Menezes': 'bg-yellow-500', 'Queiruja': 'bg-indigo-500', 'Reis': 'bg-purple-500',
            'Nunes': 'bg-pink-500', 'Figueiredo': 'bg-teal-500', 'Borges': 'bg-orange-500',
            'Oliveira': 'bg-cyan-500', 'Abrantes': 'bg-lime-500', 'Silva': 'bg-gray-500',
            'Dias': 'bg-emerald-500'
        };

        // Fun√ß√£o para buscar e processar os dados CSV
        async function fetchData(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Erro na rede: ${response.statusText}`);
                }
                const text = await response.text();
                // Simples parser de CSV
                const rows = text.trim().split('\n').slice(1); // Ignora o cabe√ßalho
                return rows.map(row => {
                    // Trata aspas e v√≠rgulas dentro dos campos
                    const values = [];
                    let current = '';
                    let inQuotes = false;
                    for (const char of row) {
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            values.push(current.trim());
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    values.push(current.trim());
                    return values;
                });
            } catch (error) {
                console.error(`Falha ao buscar dados de ${url}:`, error);
                return []; // Retorna um array vazio em caso de erro
            }
        }

        // Fun√ß√£o para obter medalha ou posi√ß√£o
        function getMedal(position) {
            const posNum = parseInt(position, 10);
            if (posNum === 1) return 'ü•á';
            if (posNum === 2) return 'ü•à';
            if (posNum === 3) return 'ü•â';
            return position;
        }

        // Fun√ß√£o principal para popular todas as tabelas
        async function populateAllTables() {
            const [
                dataRegionaisEquipe,
                dataRegionaisIndividual,
                dataConsultores
            ] = await Promise.all([
                fetchData(sheetUrls.regionaisEquipe),
                fetchData(sheetUrls.regionaisIndividual),
                fetchData(sheetUrls.consultores)
            ]);

            const allConsultores = dataConsultores.map(row => ({
                pos: row[0],
                nome: row[1],
                vendas: parseInt(row[2], 10) || 0,
                regional: row[3]
            }));

            updateTotalProgress(dataRegionaisEquipe);
            populateRegionaisEquipe(dataRegionaisEquipe, allConsultores);
            populateRegionaisIndividual(dataRegionaisIndividual);
            populateConsultoresIndividual(allConsultores);
            populateTop3Podium(allConsultores);
            updateTimestamp();
        }

        function updateTotalProgress(data) {
            const metaTotalElement = document.getElementById('meta-total');
            const totalVendasElement = document.getElementById('total-vendas');
            const faltamVendasElement = document.getElementById('faltam-vendas');
            const progressBar = document.getElementById('total-progress');
            const rocket = document.getElementById('rocket');

            if (!data.length) return;

            const totalVendas = data.reduce((sum, row) => sum + (parseInt(row[2], 10) || 0), 0);
            const metaTotal = data.reduce((sum, row) => sum + (parseInt(row[3], 10) || 0), 0);
            
            metaTotalElement.textContent = metaTotal;
            totalVendasElement.textContent = totalVendas;
            faltamVendasElement.textContent = `FALTAM: ${Math.max(0, metaTotal - totalVendas)}`;

            const percentage = metaTotal > 0 ? (totalVendas / metaTotal) * 100 : 0;
            
            progressBar.style.width = `${Math.min(percentage, 100)}%`;
            rocket.style.left = `${Math.min(percentage, 100)}%`;
            
            if (percentage >= 80) {
                progressBar.style.background = 'linear-gradient(90deg, #FBBF24, #F59E0B)'; // Dourado
            } else if (percentage >= 50) {
                progressBar.style.background = 'linear-gradient(90deg, #F97316, #FBBF24)'; // Laranja para Amarelo
            } else {
                progressBar.style.background = 'linear-gradient(90deg, #F97316, #EF4444)'; // Laranja para Vermelho
            }
        }
        
        function populateTop3Podium(consultores) {
            const podiumContainer = document.getElementById('top3-podium');
            if (!podiumContainer || !consultores.length) return;

            const top3 = consultores.slice(0, 3);
            podiumContainer.innerHTML = ''; // Limpa o container

            top3.forEach(consultor => {
                const pos = parseInt(consultor.pos, 10);
                const podiumCard = document.createElement('div');
                podiumCard.className = `card podium-card podium-${pos}`;
                
                let trophy = '';
                if (pos === 1) trophy = 'üèÜ';
                if (pos === 2) trophy = 'ü•à';
                if (pos === 3) trophy = 'ü•â';

                podiumCard.innerHTML = `
                    <div class="podium-trophy">${trophy}</div>
                    <h4 class="font-bold text-lg text-white mt-2">${consultor.nome}</h4>
                    <p class="text-2xl font-extrabold text-cyan-400">${consultor.vendas}</p>
                    <p class="text-xs text-gray-400">vendas</p>
                `;
                podiumContainer.appendChild(podiumCard);
            });
        }


        function populateRegionaisEquipe(data, allConsultores) {
            const tableBody = document.getElementById('regionais-equipe');
            if (!tableBody) return;
            tableBody.innerHTML = '';
            
            data.forEach((row, index) => {
                const pos = row[0];
                const nome = row[1];
                const vendas = parseInt(row[2], 10) || 0;
                const meta = parseInt(row[3], 10) || 1;
                const percentage = Math.min((vendas / meta) * 100, 100);
                const icon = percentage >= 50 ? '‚ö°Ô∏è' : '‚è≥';

                const rowClass = index % 2 === 0 ? 'table-row-even' : 'table-row-odd';
                const tableRow = document.createElement('tr');
                tableRow.className = `table-row ${rowClass} border-b border-gray-700 cursor-pointer`;
                tableRow.innerHTML = `
                    <td class="px-4 py-3 font-medium">${getMedal(pos)}</td>
                    <td class="px-4 py-3 font-semibold">${nome}</td>
                    <td class="px-4 py-3 text-right">
                        <div class="flex items-center justify-end gap-2">
                            <span class="font-mono text-xs">${vendas}/${meta}</span>
                            <span>${icon}</span>
                        </div>
                    </td>
                `;

                const detailsRow = document.createElement('tr');
                detailsRow.className = 'details-row';
                detailsRow.innerHTML = `<td colspan="3" class="p-0"></td>`;
                
                tableBody.appendChild(tableRow);
                tableBody.appendChild(detailsRow);
                
                tableRow.addEventListener('click', () => {
                    const isOpen = detailsRow.classList.toggle('open');
                    
                    document.querySelectorAll('.details-row.open').forEach(openRow => {
                        if(openRow !== detailsRow) {
                            openRow.classList.remove('open');
                            openRow.querySelector('td').innerHTML = '';
                        }
                    });

                    if (isOpen) {
                        const consultoresDaRegional = allConsultores.filter(c => c.regional === nome);
                        const detailsContent = document.createElement('div');
                        detailsContent.className = 'bg-gray-900 p-4';
                        
                        if (consultoresDaRegional.length > 0) {
                            let consultoresHtml = '<table class="w-full text-xs">';
                            consultoresHtml += '<thead class="text-gray-400"><tr><th class="px-2 py-1">Pos.</th><th class="px-2 py-1">Consultor</th><th class="px-2 py-1 text-center">Vendas</th></tr></thead><tbody>';
                            consultoresDaRegional.forEach(c => {
                                consultoresHtml += `<tr class="border-b border-gray-800"><td class="px-2 py-1">${c.pos}¬∫</td><td class="px-2 py-1">${c.nome}</td><td class="px-2 py-1 text-center">${c.vendas}</td></tr>`;
                            });
                            consultoresHtml += '</tbody></table>';
                            detailsContent.innerHTML = consultoresHtml;
                        } else {
                            detailsContent.innerHTML = '<p class="text-center text-gray-500 text-xs">Nenhum consultor encontrado para esta regional.</p>';
                        }
                        detailsRow.querySelector('td').appendChild(detailsContent);
                    } else {
                         detailsRow.querySelector('td').innerHTML = '';
                    }
                });
            });
        }

        function populateRegionaisIndividual(data) {
            const tableBody = document.getElementById('regionais-individual');
            if (!tableBody) return;
            tableBody.innerHTML = '';
            data.forEach((row, index) => {
                const pos = row[0];
                const nome = row[1];
                const vendas = row[2];
                
                const rowClass = index % 2 === 0 ? 'table-row-even' : 'table-row-odd';
                const tableRow = `
                    <tr class="table-row ${rowClass} border-b border-gray-700">
                        <td class="px-4 py-3 font-medium">${getMedal(pos)}</td>
                        <td class="px-4 py-3 font-semibold">${nome}</td>
                        <td class="px-4 py-3 text-center font-bold">${vendas}</td>
                    </tr>
                `;
                tableBody.innerHTML += tableRow;
            });
        }

        function populateConsultoresIndividual(data) {
            const tableBody = document.getElementById('consultores-individual');
            if (!tableBody) return;
            tableBody.innerHTML = '';
            
            data.forEach((item, index) => {
                const rowClass = index % 2 === 0 ? 'table-row-even' : 'table-row-odd';
                const regionalTag = item.regional && item.regional.trim() !== ''
                    ? `<span class="regional-tag ${regionalColors[item.regional] || 'bg-gray-600'}">${item.regional}</span>`
                    : '';
                
                const tableRow = `
                    <tr class="table-row ${rowClass} border-b border-gray-700">
                        <td class="px-4 py-3 font-medium">${getMedal(item.pos)}</td>
                        <td class="px-4 py-3 font-semibold">${item.nome} ${regionalTag}</td>
                        <td class="px-4 py-3 text-center font-bold">${item.vendas}</td>
                    </tr>
                `;
                tableBody.innerHTML += tableRow;
            });
        }

        function updateTimestamp() {
            const now = new Date();
            const date = now.toLocaleDateString('pt-BR');
            const time = now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('last-updated').textContent = `Atualizado em: ${date} ${time}`;
        }
        
        document.addEventListener('DOMContentLoaded', populateAllTables);
    </script>
</body>
</html>

